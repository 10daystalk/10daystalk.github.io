---
title: Android统计列表滑动帧率
layout: post

categories: post
tags:
- Android
- RecyclerView
- Performance
---
我们的日常项目中，免不了接触各种各样的列表。从简单样式的联系人列表，到复杂的Feed流。列表的优化不再局限于以往的ListView优化，也就是说使用仅仅ViewHolder机制已不能够保证开发一个流畅的列表了。像Feed流的场景，列表中充斥着各种各样的图片、自定义控件、音视频播放调度、手势触控、消息传递等等，需要做太多太多的事情了。此时如何能保证Feed流的平滑滑动就变得相当重要！而流畅的衡量标准就是帧率，即fps。这篇文章主要介绍统计列表滑动帧率的方法。

### 统计原理
![统计原理](https://github.com/jinkg/jinkg.github.io/blob/master/static/images/fps_01.png)

当某一事件触发时，我们开始记录下系统绘制的帧数。事件结束或者到达一定时长时，停止记录。此时 帧率 = 帧数 / (start - end)。

有几个因素会影响统计精度：
* 统计时长，丢帧通常发生在某一小段时间，此时间段内或应用执行的任务较多。那么统计过长会稀释掉小段时间的丢帧
* 时间单位，通常将开始时间和结束时间精确到纳秒进行计算。

因此在列表滑动的场景，列表开始滑动可以作为起始点。列表停止滑动或者滑动到达一定时间可以作为结束点。计算出此时的fps，即可作为列表滑动的fps。那么应该如何统计帧数呢？

### android.view.Choreographer类获取帧回调
